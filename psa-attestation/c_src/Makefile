# This makefile is used within the docker image generated by docker/Dockerfile
#
# AUTHORS
#
# The Veracruz Development Team.
#
# COPYRIGHT
#
# See the `LICENSE_MIT.markdown` file in the Veracruz root directory for licensing
# and copyright information.

OUT_DIR?=.
INCLUDE_PATHS=-I ../include/ -I ../include/internal/ -I ../../rust-psa-crypto/psa-crypto-sys/vendor/include -I ../lib/QCBOR/inc -I ../lib/t_cose/inc -I ../lib/t_cose/inc/t_cose -I ../lib/psa_crypto/include/

.PHONY: clean all

all: $(OUT_DIR)/libpsa_attestation.a

CFLAGS=-g -fPIC
$(OUT_DIR)/libpsa_attestation.a: $(OUT_DIR)/psa_attestation.o $(OUT_DIR)/attestation_core.o $(OUT_DIR)/attest_token.o
	ar cr $@ $(OUT_DIR)/psa_attestation.o $(OUT_DIR)/attestation_core.o $(OUT_DIR)/attest_token.o

$(OUT_DIR)/psa_attestation.o: psa_attestation.c ../include/internal/attestation.h ../include/psa/initial_attestation.h
	$(CC) $(CFLAGS) -c -o $@ psa_attestation.c $(INCLUDE_PATHS)

$(OUT_DIR)/attestation_core.o: attestation_core.c ../include/internal/attestation.h ../include/psa/initial_attestation.h
	$(CC) $(CFLAGS) -c -o $@ attestation_core.c $(INCLUDE_PATHS)
$(OUT_DIR)/attest_token.o: attest_token.c
	$(CC) $(CFLAGS) -c -o $@ attest_token.c $(INCLUDE_PATHS)

clean:
	rm -f $(OUT_DIR)/*.o $(OUT_DIR)/*.a
